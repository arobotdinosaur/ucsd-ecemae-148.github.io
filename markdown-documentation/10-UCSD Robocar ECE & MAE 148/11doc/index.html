
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../10docfinal/">
      
      
        <link rel="next" href="../10-UCSD%20Robocar%20ECE%20%26%20MAE%20148/10UCSDRobocarECEMAE148.html">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>GPS Laps - ECE/MAE148</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.9f615399.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.649f08f9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gps-path-following" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ECE/MAE148" class="md-header__button md-logo" aria-label="ECE/MAE148" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ECE/MAE148
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GPS Laps
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ECE/MAE148" class="md-nav__button md-logo" aria-label="ECE/MAE148" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ECE/MAE148
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../50-Virtual%20Machine%20with%20DonkeyCar%20AI%20Simulator/50-Virtual%20Machine%20and%20DonkeyCar%20AI%20Simulator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DonkeySimulator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../30-UCSD%20Robocar%20Jetson%20Nano%20Configuration/30-UCSD%20Robocar%20Jetson%20Nano%20Configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jetson Initial Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../60-OpenCV%20CUDA%20Accelerated/60docfinal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenCV With CUDA Acceleration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../60-OpenCV%20CUDA%20Accelerated/60doccommonmark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenCV With CUDA Acceleration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../15-VESC%20Setup%20Instructions/15-VESC%20Setup%20Instructions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VESC Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../10doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DonkeyCar Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../10docfinal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DonkeyCar Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    GPS Laps
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    GPS Laps
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gnss-configuration" class="md-nav__link">
    GNSS Configuration:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-plug-pointonenav-to-donkeycar" class="md-nav__link">
    How to Plug PointOneNav to Donkeycar
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-section-configuring-the-gps-to-publish-coordinates-to-the-ros2-topic-fix" class="md-nav__link">
    Optional Section: Configuring the GPS to Publish Coordinates to the ROS2 Topic /fix
  </a>
  
    <nav class="md-nav" aria-label="Optional Section: Configuring the GPS to Publish Coordinates to the ROS2 Topic /fix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#most-groups-will-not-need-to-use-this-this-section-only-applies-if-you-need-it-for-your-final-project" class="md-nav__link">
    Most groups will not need to use this, this section only applies if you need it for your final project.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../10-UCSD%20Robocar%20ECE%20%26%20MAE%20148/10UCSDRobocarECEMAE148.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML TEST Robocar Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../100-UCSD%20Robocar%20Framework/100-UCSD%20Robocar%20Framework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UCSD Robocar Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../ROS2_Guide_Book.pdf" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROS2 Guidebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../documentation/Controller/UCSD%20Robocar%20Using%20BetaFPV%20LiteRadio%203%20Pro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Winter 23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Winter 23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 9
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 12
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 13
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 14
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 15
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gnss-configuration" class="md-nav__link">
    GNSS Configuration:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-plug-pointonenav-to-donkeycar" class="md-nav__link">
    How to Plug PointOneNav to Donkeycar
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-section-configuring-the-gps-to-publish-coordinates-to-the-ros2-topic-fix" class="md-nav__link">
    Optional Section: Configuring the GPS to Publish Coordinates to the ROS2 Topic /fix
  </a>
  
    <nav class="md-nav" aria-label="Optional Section: Configuring the GPS to Publish Coordinates to the ROS2 Topic /fix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#most-groups-will-not-need-to-use-this-this-section-only-applies-if-you-need-it-for-your-final-project" class="md-nav__link">
    Most groups will not need to use this, this section only applies if you need it for your final project.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="gps-path-following">GPS Path Following</h1>
<h2 id="gnss-configuration">GNSS Configuration:</h2>
<h2 id="how-to-plug-pointonenav-to-donkeycar">How to Plug PointOneNav to Donkeycar</h2>
<ol>
<li>
<p>Make sure your user is added to the dialout group. If not</p>
<p>a.  sudo adduser jetson dialout</p>
<p>b.  sudo reboot now</p>
</li>
<li>
<p>Download
    <a href="https://drive.google.com/file/d/1BK_UjH-He9d_D4eObWMHzpHHCqmtq75h/view?usp=share_link">[https://drive.google.com/file/d/1BK_UjH-He9d_D4eObWMHzpHHCqmtq75h/view?usp=share_link]{.underline}</a>
    (Note that this zip file cannot be shared outside of the class. It
    is still proprietary as of now)</p>
</li>
<li>
<p>Unzip.</p>
</li>
<li>
<p>Run</p>
<p>a.  cd quectel-lg69t-am.0.15.0/p1_runner</p>
<p>b.  deactivate (This should get you out of the current environment)</p>
<p>c.  wget
    https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-pypy3-Linux-aarch64.sh
    .</p>
<p>d.  bash Mambaforge-pypy3-Linux-aarch64.sh</p>
<p>e.  Reboot the jetson</p>
<p>f.  mamba create --name py37 -c conda-forge python=3.7 pip</p>
<p>g.  mamba activate py37</p>
<p>h.  [pip3 install -e .]{.mark}</p>
<pre><code>i.  %If this fails, you can try just going to the p1_runner
    directory and running the python3 bin/config_tool.py
    command, and then doing "pip install \_\_\_\_" for all the
    missing things, you may just need

    1.  pip install pyserial

    2.  pip install fusion_engine_client

    3.  pip install pynmea

    4.  pip install ntripstreams

    5.  pip install websockets
</code></pre>
<p>i.  python3 bin/config_tool.py reset factory</p>
<p>j.  python3 bin/config_tool.py apply uart2_message_rate nmea gga on</p>
<p>k.  python3 bin/config_tool.py save</p>
<p>l.  python3 bin/runner.py --device-id \&lt;polaris_username&gt;
    --polaris \&lt;polaris_password&gt; --device-port /dev/ttyUSB1</p>
</li>
</ol>
<blockquote>
<p>(if not getting any data including Nans try USB0)</p>
</blockquote>
<p>Note: The GPS corrections will only happen when you are actively running
runner.py. I recommend making a bashrc command that you can run to start
up the runner.py program easily in a 2nd terminal while using the GPS
for anything.</p>
<ol>
<li>
<p>Create a project with the DonkeyCar path follow template</p>
<p>a.  Open a new terminal window</p>
<p>b.  Make sure that the donkey car environment is running</p>
<pre><code>i.  source \~/projects/envs/donkey/bin/activate
</code></pre>
<p>c.  cd \~/projects</p>
<p>d.  donkey createcar --path ./mycar --template path_follow</p>
</li>
<li>
<p>Set the following in the myconfig.py</p>
<p>a.  GPS_SERIAL = "/dev/ttyUSB2" (USB1 if USB0 used above)</p>
<p>b.  GPS_SERIAL_BAUDRATE = 460800</p>
<p>c.  GPS_DEBUG = True</p>
<p>d.  HAVE_GPS = True</p>
<p>e.  GPS_NMEA_PATH = None</p>
</li>
<li>
<p>Also set things like the VESC parameters in myconfig.py. You can
    copy these over from the donkeycar you created earlier.</p>
</li>
<li>
<p>Run</p>
<p>a.  python3 manage.py drive</p>
</li>
<li>
<p>You should see GPS positions being outputted after you run
    Donkeycar. If you don't want to output set GPS_DEBUG to False</p>
</li>
<li>
<p>Configure button actions</p>
<p>a.  SAVE_PATH_BTN is the button to save the in-memory path to a
    file.</p>
<p>b.  LOAD_PATH_BTN is the button to (re)load path from the csv file
    into memory.</p>
<p>c.  RESET_ORIGIN_BTN is the button to set the current position as
    the origin.</p>
<p>d.  ERASE_PATH_BTN is the button to erase path from memory and reset
    the origin.</p>
<p>e.  TOGGLE_RECORDING_BTN is the button to toggle recording mode on
    or off. Note that there is a pre-assigned button in the web ui,
    so there is not need to assign this button to one of the web/w*
    buttons if you are using the web ui.</p>
<p>f.  INC_PID_D_BTN is the button to change PID \'D\' constant by
    PID_D_DELTA.</p>
<p>g.  DEC_PID_D_BTN is the button to change PID \'D\' constant by
    -PID_D_DELTA</p>
<p>h.  INC_PID_P_BTN is the button to change PID \'P\' constant by
    PID_P_DELTA</p>
<p>i.  DEC_PID_P_BTN is the button to change PID \'P\' constant by
    -PID_P_DELTA</p>
</li>
</ol>
<blockquote>
<p>The logitech buttons are named stuff like "X" or "R1" See the example
config below.\
SAVE_PATH_BTN = \"R1\" # button to save path</p>
<p>LOAD_PATH_BTN = \"X\" # button (re)load path</p>
<p>RESET_ORIGIN_BTN = \"B\" # button to press to move car back to origin</p>
<p>ERASE_PATH_BTN = \"Y\" # button to erase path</p>
<p>TOGGLE_RECORDING_BTN = \"L1\" # button to toggle recording mode</p>
<p>INC_PID_D_BTN = None # button to change PID \'D\' constant by
PID_D_DELTA</p>
<p>DEC_PID_D_BTN = None # button to change PID \'D\' constant by
-PID_D_DELTA</p>
<p>INC_PID_P_BTN = \"None\" # button to change PID \'P\' constant by
PID_P_DELTA</p>
<p>DEC_PID_P_BTN = \"None\" # button to change PID \'P\' constant by
-PID_P_DELTA</p>
<p>#</p>
</blockquote>
<ol>
<li>
<p>Recording a path</p>
<p>a.  The algorithm assumes we will be driving in a continuous
    connected path such that the start and end are the same. You can
    adjust the space between recorded waypoints by editing the
    PATH_MIN_DIST value in myconfig.py You can change the name and
    location of the saved file by editing the PATH_FILENAME value.</p>
<p>b.  Enter User driving mode using either the web controller or a
    game controller.</p>
<p>c.  Move the car to the desired starting point</p>
<p>d.  Erase the path in memory (which will also reset the origin).</p>
<pre><code>Note:  Make sure to reset the origin!!! If you didn't need to erase
    the path in memory you can just go ahead with toggling recording
</code></pre>
<p>e.  Toggle recording on.</p>
<p>f.  Drive the car manually around the track until you reach the
    desired starting point again.</p>
<p>g.  Toggle recording off.</p>
<p>h.  If desired, save the path.</p>
</li>
<li>
<p>Following a path</p>
<p>a.  Enter User driving mode using either the web controller or a
    game controller.</p>
<p>b.  Move the car to the desired starting point - make sure it's the
    same one from when you recorded the path</p>
<p>c.  Reset the origin (be careful; don\'t erase the path, just reset
    the origin).</p>
<p>d.  Load the path</p>
<p>e.  Enter Autosteering or Autopilot driving mode. This is normally
    done by pressing the start button either once or twice If you
    are in Autosteering mode you will need to manually provide
    throttle for the car to move. If you are in Autopilot mode the
    car should drive itself completely.</p>
</li>
<li>
<p>Configuring Path Follow Parameters</p>
<p>a.  So the algorithm uses the cross-track error between a desired
    line and the vehicle\'s measured position to decide how much and
    which way to steer. But the path we recorded is not a simple
    line; it is a lot of points that is typically some kind of
    circuit. As described above, we use the vehicle\'s current
    position to choose a short segment of the path that we use as
    our desired track. That short segment is recalculated every time
    we get a new measured car position. There are a few
    configuration parameters that determine exactly which two points
    on the path that we use to calculate the desired track line.</p>
<pre><code>i.  PATH_SEARCH_LENGTH = None \# number of points to search for
    closest point, None to search entire path

ii. PATH_LOOK_AHEAD = 1 \# number of points ahead of the closest
    point to include in cte track

iii. PATH_LOOK_BEHIND = 1 \# number of points behind the closest
     point to include in cte track
</code></pre>
<p>b.  Generally, if you are driving very fast you might want the look
    ahead to be larger than if driving slowly so that your steering
    can anticipate upcoming curves. Increasing the length of the
    resulting track line, by increasing the look behind and/or look
    ahead, also acts as a noise filter; it smooths out the track.
    This reduces the amount of jitter in the controller. However,
    this must be balanced with the true curves in the path; longer
    track segments effectively \'flatten\' curves and so can result
    in understeer; not steering enough when on a curve.</p>
</li>
<li>
<p>Determining PID Coefficients</p>
<p>a.  The PID coefficients are the most important (and time consuming)
    parameters to configure. If they are not correct for your car
    then it will not follow the path. The coefficients can be
    changed by editing their values in the myconfig.py file.</p>
<p>b.  PID_P is the proportional coefficient; it is multiplied with the
    cross-track error. This is the most important parameter; it
    contributes the most to the output steering value and in some
    cases may be all that is needed to follow the line. If this is
    too small then car will not turn enough when it reaches a curve.
    If this to too large then it will over-react to small changes in
    the path and may start turning in circles; especially when it
    gets to a curve.</p>
<p>c.  PID_D is the differential coefficient; it is multiplied with the
    change in the cross-track error. This parameter can be useful in
    reducing oscillations and overshoot.</p>
<p>d.  PID_I is the integral coefficient; it is multiplied with the
    total accumulated cross-track error. This may be useful in
    reducing offsets caused by accumulated error; such as if one
    wheel is slightly smaller in diameter than another.</p>
<p>e.  Determining PID Coefficients can be difficult. One approach is:</p>
<pre><code>i.  First determine the P coefficient.

ii. zero out the D and the I coefficients.

iii. Use a kind of \'binary\' search to find a value where the
     vehicle will roughly follow a recorded straight line;
     probably oscillating around it. It will be weaving

iv. Next find a D coefficient that reduces the weaving
    (oscillations) on a straight line. Then record a path with a
    tight turn. Find a D coefficient that reduces the overshoot
    when turning.

v.  You may not even need the I value. If the car becomes
    unstable after driving for a while then you may want to
    start to set this value. It will likely be much smaller than
    the other values.

vi. Be patient. Start with a reasonably slow speed. Change one
    thing at a time and test the change; don\'t make many
    changes at once. Write down what is working.

vii. Once you have a stable PID controller, then you can figure
     out just how fast you can go with it before autopilot
     becomes unstable. If you want to go faster then set the
     desired speed and start tweaking the values again using the
     method suggested above.
</code></pre>
</li>
</ol>
<h2 id="optional-section-configuring-the-gps-to-publish-coordinates-to-the-ros2-topic-fix">Optional Section: Configuring the GPS to Publish Coordinates to the ROS2 Topic /fix</h2>
<h3 id="most-groups-will-not-need-to-use-this-this-section-only-applies-if-you-need-it-for-your-final-project">Most groups will not need to use this, this section only applies if you need it for your final project.</h3>
<p>Setting up ROS2 gps publishing to /fix and /gps_fix:</p>
<ol>
<li>Start a docker container with the djnighti/ucsd_robocar:devel  image (you need the newer ubuntu version in the docker for later steps to work)
    Document 100 pg 17 has instructions on how to do this if you are confused</li>
<li>
<p>Follow the instructions in https://github.com/PointOneNav/ros2-fusion-engine-driver/blob/main/README.md 
I will write them out here with a couple bug corrections for your convenience. Note that we are running ros2 foxy, not humble</p>
</li>
<li>
<p>Install some dependencies
apt-get install ros-foxy-gps-msgs
apt install ros-foxy-nmea-msgs
apt install ros-foxy-mavros</p>
</li>
<li>
<p>Configuring your device:
Navigate to the p1-host-tools that you set up earlier</p>
</li>
</ol>
<pre><code>python3 bin/config_tool.py apply uart2_message_rate fe ROSPoseMessage 100ms
python3 bin/config_tool.py apply uart2_message_rate fe ROSGPSFixMessage 100ms
python3 bin/config_too.py save
</code></pre>
<p>The website instructions include a 3rd command which is setting up the imu. However our gps devices do not have the firmware loaded to support that, so that command will not 
work.</p>
<ol>
<li>
<p>git clone https://github.com/PointOneNav/ros2-fusion-engine-driver.git</p>
</li>
<li>
<p>cd ros2-fusion-engine-driver</p>
</li>
<li>
<p>rosdep install -i --from-path ./ --rosdistro foxy -y</p>
</li>
<li>
<p>build_ros2
    This will take a long time, about three minutes. If you get an error saying various c++ commands are not found it is the iomanip loading error. Normally, the iomanip 
library is automatically loaded into the c++ compiler, but for some reason it is not being recognized on ours. 
    To fix, navigate to the file fusion-engine-driver/utils/conversion_utils.hpp and add #include <iomanip> to the top of the file</p>
</li>
<li>
<p>To run the command, do
ros2 run fusion-engine-driver fusion_engine_ros_driver --ros-args -p connection_type:=tty -p tty_port:=/dev/ttyUSB1
We are connecting through serial. </p>
</li>
<li>
<p>To check that the gps output is being published, you can open a new terminal, enter the same container that the gps is running in, and do ros2 topic echo /fix and you 
should see lots of gps coordinates being published.</p>
</li>
</ol>
<p>Troubleshooting:
If you have version conflicts with the config.py, (specifically catkin version errors for me), try setting up the p1_tools inside of a docker container. The docker containers 
run a newer version of ubuntu linux which can help fix these conflicts.</p>
<p>If you have significant configuration issues, running<br />
python3 bin/config_tool.py reset factory 
and then reconfiguring can be a good idea to fix them.</p>
<p>If you decide you don't need the fusion-engine-client and want fast build times, I recommend modifying the build_ros2 command in the ~./bashrc to exlude the 
fusion-engine-driver package for faster loading time, unless you really need it. Excluding the ntrip_client can save time too. </p>
<p>Here is the changed build_ros2 command
function build_ros2() {
  cd /home/projects/ros2_ws 
  rm -rf build/ install/ log/ 
  colcon build --packages-ignore fusion-engine-driver ntrip_client
  source install/setup.bash
}
make sure to source ~/.bashrc after to have the changes take effect</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>