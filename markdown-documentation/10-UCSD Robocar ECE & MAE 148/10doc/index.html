
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../15-VESC%20Setup%20Instructions/15-VESC%20Setup%20Instructions/">
      
      
        <link rel="next" href="../11doc/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>DonkeyCar Installation - ECE/MAE 148</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.9f615399.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.649f08f9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#table-of-contents" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ECE/MAE 148" class="md-header__button md-logo" aria-label="ECE/MAE 148" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ECE/MAE 148
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DonkeyCar Installation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ECE/MAE 148" class="md-nav__button md-logo" aria-label="ECE/MAE 148" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ECE/MAE 148
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../50-Virtual%20Machine%20with%20DonkeyCar%20AI%20Simulator/50-Virtual%20Machine%20and%20DonkeyCar%20AI%20Simulator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DonkeySimulator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../50-Virtual%20Machine%20with%20DonkeyCar%20AI%20Simulator/Donkeysim%20on%20an%20ARM%20Chip%20Mac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DonkeySimulator Mac
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../30-UCSD%20Robocar%20Jetson%20Nano%20Configuration/30-UCSD%20Robocar%20Jetson%20Nano%20Configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jetson Initial Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../60-OpenCV%20CUDA%20Accelerated/60doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenCV With CUDA Acceleration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../15-VESC%20Setup%20Instructions/15-VESC%20Setup%20Instructions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VESC Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    DonkeyCar Installation
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../11doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPS Laps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../10-UCSD%20Robocar%20ECE%20%26%20MAE%20148/10UCSDRobocarECEMAE148.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML TEST Robocar Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../100-UCSD%20Robocar%20Framework/100-UCSD%20Robocar%20Framework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UCSD Robocar Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../ROS2_Guide_Book.pdf" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROS2 Guidebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../documentation/Controller/UCSD%20Robocar%20Using%20BetaFPV%20LiteRadio%203%20Pro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Winter 23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Winter 23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 9
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 12
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 13
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 14
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../win23team15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team 15
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<p><strong>UCSD RoboCar ECE &amp; MAE 148</strong></p>
<p>Version 20.7 - 23Oct2022</p>
<p>Prepared by</p>
<p>Dr. Jack Silberman</p>
<p>Department of Electrical and Computer Engineering</p>
<p>and</p>
<p>Dominic Nightingale</p>
<p>Department of Mechanical and Aerospace Engineering</p>
<p>University of California, San Diego</p>
<p>9500 Gilman Dr, La Jolla, CA 92093</p>
<p><img alt="" src="../10images/media/image45.png" /></p>
<p><img alt="" src="../10images/media/image21.png" /></p>
<h1 id="table-of-contents">Table of Contents</h1>
<p><strong><a href="#table-of-contents">Table of Contents</a> 2</strong></p>
<p><strong><a href="#introduction">Introduction</a> 4</strong></p>
<p><strong><a href="#single-board-computer-sbc-basic-setup">Single Board Computer (SBC) Basic
Setup</a> 5</strong></p>
<blockquote>
<p><a href="#jetson-nano-jtn-configuration">Jetson Nano (JTN) Configuration</a> 5</p>
<p><a href="#jetson-xavier-nx-jnx-configuration">Jetson Xavier NX Configuration</a>
5</p>
</blockquote>
<p><strong><a href="#hardware-setup">Hardware Setup</a> 6</strong></p>
<blockquote>
<p><a href="#jetson-nano-gpio-header-pinout">Jetson Nano GPIO Header PINOUT</a> 6</p>
<p><a href="#vesc">VESC</a> 7</p>
<p><a href="#_s281f6m5z2vd">VESC Hardware V6.x</a> 8</p>
<p><a href="#_fh8ltsnwmmrd">Motor Detection</a> 10</p>
<p><a href="#_2d2r0k5t70f4">Sensor Detection</a> 14</p>
<p><a href="#_9ymkdmchduhq">Enable Servo Control For Steering</a> 16</p>
<p><a href="#_ohr8s4phbsb0">VESC Hardware V4.12 (if you have V6, skip this)</a> 17</p>
<p><a href="#pwm-controller">PWM Controller</a> 18</p>
<p><a href="#wiring-adafruit-board">Wiring adafruit board</a> 19</p>
<p><a href="#detecting-the-pwm-controller">Detecting the PWM controller</a> 20</p>
<p><a href="#emergency-stop---relay">Emergency stop - Relay</a> 21</p>
<p><a href="#logitech-f710-controller">Logitech F710 controller</a> 23</p>
<p><a href="#other-joystick-controllers">Other JoyStick Controllers</a> 23</p>
<p><a href="#ld06-lidar">LD06 Lidar</a> 25</p>
<p><a href="#laser-map">Laser Map</a> 25</p>
<p><a href="#mechanical-drawing">Mechanical drawing</a> 25</p>
</blockquote>
<p><strong><a href="#_8sb9o86fl4d1">Install OpenCV from Source</a> 26</strong></p>
<p><strong><a href="#donkeycar-ai-framework">DonkeyCar AI Framework</a> 26</strong></p>
<blockquote>
<p><a href="#setting-up-the-donkeycar-ai-framework">Setting up the DonkeyCar AI
Framework</a> 26</p>
<p><a href="#create-a-virtual-environment-for-the-donkeycar-ai-framework.">Create a virtual environment for the DonkeyCar AI
Framework.</a>
27</p>
<p><a href="#_vgqx7t3x8yes">Confirm openCV build from previous steps</a> 28</p>
<p><a href="#tensorflow">Tensorflow</a> 29</p>
<p><a href="#_k329co33iptx">PyTorch</a> 32</p>
<p><a href="#section-9">Installing Donkeycar AI Framework</a> 35</p>
<p><a href="#create-a-car">Create a Car</a> 36</p>
<p><a href="#_jok809vjuom8">Donkeycar manage.py</a> 37</p>
<p><a href="#_nkz3143022ot">Modifying PWM board configuration</a> 37</p>
<p><a href="#modifying-camera">Modifying Camera</a> 37</p>
<p><a href="#quick-test">Quick Test</a> 38</p>
<p><a href="#modifying-joystick">Modifying Joystick</a> 39</p>
<p><a href="#calibration-of-the-throttle-and-steering">Calibration of the Throttle and
Steering</a> 41</p>
<p><a href="#begin-calibration">Begin Calibration</a> 42</p>
<p><a href="#saving-car-configuration-file">Saving car configuration file</a> 44</p>
<p><a href="#driving-the-robot-to-collect-data">Driving the Robot to Collect
data</a> 46</p>
</blockquote>
<p><strong><a href="#backup-of-the-usd-card">Backup of the uSD Card</a> 50</strong></p>
<blockquote>
<p><a href="#if-needed-we-have-an-jtn-usd-card-image-ready-for-plug-and-play">If needed, we have an uSD Card Image Ready for Plug and
Play</a>
52</p>
</blockquote>
<p><strong><a href="#ros-with-docker">ROS with Docker</a> 53</strong></p>
<p><strong><a href="#supporting-material">Supporting material</a> 54</strong></p>
<h1 id="_1"></h1>
<h1 id="introduction">Introduction</h1>
<p>This document was derived from the DIY RoboCar - Donkey Car Framework</p>
<p>Reference information can be found at
<a href="http://docs.donkeycar.com">http://docs.donkeycar.com</a></p>
<p>At UC San Diego's Introduction to Autonomous Vehicles class (ECE
MAE148), we use an AI Framework called Donkey Car which is based on Deep
Learning / Human behavior cloning as well as we do traditional
programming using Robot Operating System (ROS2).</p>
<p>DonkeyCar can be seen as the "hello world" of affordable scaled
autonomous cars</p>
<p>We have added other features into our UCSD scale robot cars that are not
found at the Default Donkey car build such as a wireless emergency off switch.
Therefore, please follow the instructions found in this document vs. the default Donkey built.</p>
<p>Another framework we use called UCSD Robocar is primarily maintained and
developed by Dominic Nightingale right here at UC San Diego. UCSD
Robocar uses ROS and ROS2 for controlling our scaled robot cars which
can vary from traditional programming or machine learning to achieve an
objective. The framework works with a vast selection of sensors and
actuation methods in our inventory making it a robust framework to use
across various platforms. Has been tested on 1/16, 1/10, 1/5 scaled
robot cars and soon our go-karts.</p>
<p>As August 2019 we transitioned from the single board computer (SBC)
called Raspberry PI to the Nvidia Jetson Nano. If you are using a Raspberry PI, then search in this
document for Raspberry PI (RPI or PI) Configuration.</p>
<p>On 28Aug19, we updated the instructions to include Raspberry PI 4B Depending on your Single Board Computer, Jetson Xavier NX, Jetson Nano, then follow the related instructions.</p>
<h1 id="_2"></h1>
<h1 id="single-board-computer-sbc-basic-setup">Single Board Computer (SBC) Basic Setup</h1>
<p>We will be using the Ubuntu Linux distribution. In the class you have
access to a virtual machine image file with Ubuntu.</p>
<p>We won't install ROS2 directly into the SBC, we will be using Docker
images and containers.</p>
<p>You will install OpenCV from source as part of your learning on
compiling and building software from source.</p>
<h2 id="jetson-nano-jtn-configuration">Jetson Nano (JTN) Configuration</h2>
<p><a href="https://docs.google.com/document/d/1TF1uGAFeDARNwbPkgg9xg4NvWPJvrsHW2I_IN9dWQH0/edit?usp=sharing">Instructions to configure the Jetson
Nano</a></p>
<h2 id="jetson-xavier-nx-jnx-configuration">Jetson Xavier NX (JNX) Configuration</h2>
<p><a href="https://docs.google.com/document/d/1mXgN9DcAj30HAsbfrHNCP-YEYqKWPTbcUssRI1Xab1A/edit?usp=sharing">Instructions to Configure the Jetson Xaviver
NX</a></p>
<p><a href="https://developer.nvidia.com/embedded/jetpack-archive">Archive location to previous JetPack
versions</a></p>
<h2 id="editing-remotely-with-jupyter-notebooks">Editing Remotely with Jupyter Notebooks</h2>
<p>Install Jupyter notebook on your Jetson:</p>
<hr />
<p>sudo apt install jupyter-notebook</p>
<hr />
<hr />
<p><a href="https://ljvmiranda921.github.io/notebook/2018/01/31/running-a-jupyter-notebook/">https://ljvmiranda921.github.io/notebook/2018/01/31/running-a-jupyter-notebook/</a></p>
<p>Help document for editing using Jupyter notebook:</p>
<p><a href="https://docs.google.com/document/d/1ZNACJvKmQNnN7QNMwgqnzjrs9JDdFbiqVFHAuhgillQ/edit?usp=sharing">Conifguring Jupyter Notebook on
SSH</a></p>
<h1 id="hardware-setup">Hardware Setup</h1>
<p>You should consider breaking the work on building the robots per team
member:</p>
<p>a)  Someone could start to build OpenCV GPU accelerated in parallel
    while you build the robot. <a href="https://docs.google.com/document/d/1HX2zmjbVsyLnliEQ8wp97Y453g5qNAYHWtFQiKQ0elA/edit?usp=sharing">It will take several hours building
    OpenCV from
    source</a>.
    Try to divide the work by team members ...</p>
<p>b)  Start designing, 3D Printing, Laser Cutting the parts</p>
<p>As of Spring 2022, we upgraded all the ECE MAE 148 robots to use VESCs.</p>
<h2 id="vesc">VESC</h2>
<p>VESC is a super cool Electronic Speed Controller (ESC) that runs open
source code with significantly more capabilities than a regular RC Car ESC.</p>
<p>VESCs are very popular for electrical skateboards, DIY electrical
scooters, and robotics.</p>
<p>For robotics, one of the capabilities we will use the most is Odometry
(speed and position)</p>
<p>based on the sensors on brushless motors (sensored) or to some extent,
specially using the latest VESCs and firmware, it is also available with
brushless motors without sensors (sensorless).</p>
<p><a href="https://vesc-project.com/">https://vesc-project.com/</a></p>
<p><a href="https://docs.google.com/document/d/1Y5DdvWdtFjbeyGIVJyWAb8Wrq6M1MkCkMPiDgT4LoQY/edit?usp=sharing">VESC Setup
Instructions</a></p>
<h2 id="logitech-f710-controller">Logitech F710 controller</h2>
<p>Place your Logitech F710 controller on the [x mode]{.mark}</p>
<p>(look for small switch in one of the controller face)</p>
<p>Connect the USB JoyStick Dongle into the JTN and then list the input
devices again</p>
<p>ls /dev/input</p>
<blockquote>
<p>(env) jetson@ucsdrobocar00:\~/projects/d3\$ ls /dev/input</p>
<p>by-id event0 event2 event4 mice mouse1</p>
<p>by-path event1 event3 [js0]{.mark} mouse0</p>
</blockquote>
<p>We are looking for a js0</p>
<h3 id="other-joystick-controllers">Other JoyStick Controllers</h3>
<p>JoyStick Controllers - either the Logitech F-10 or PS4</p>
<p>Make sure your myconfig.py on your car directory reflects your
controller</p>
<p>Connecting the LogiTech Controller is as easy as plugging in the USB
dongle at the SBC.</p>
<p>[If you want to check controller was connected]</p>
<p>ls /dev/input</p>
<p>[and see if js0 is listed.]</p>
<p>[Lets test the joystick in a linux machine]</p>
<p>sudo apt-get update</p>
<p>sudo apt-get install -y jstest-gtk</p>
<p>jstest /dev/input/js0</p>
<p>To remove a device, let\'s say another JoyStick that you don't use
anymore</p>
<p>bluetoothctl</p>
<p>paired-devices</p>
<p>remove THE_CONTROLLER_MAC_ADDRESS</p>
<h2 id="ld06-lidar">LD06 Lidar</h2>
<p>Datasheet for LD06 lidar:
<a href="https://drive.google.com/file/d/1t0CkEEd9fYG_eIq_DL8eqy4NywQQDrjg/view?usp=sharing">[datasheet]{.underline}</a></p>
<h3 id="laser-map">Laser Map</h3>
<p><img alt="" src="../10images/media/image9.png" /></p>
<h3 id="mechanical-drawing">Mechanical drawing</h3>
<p><img alt="" src="../10images/media/image6.png" /></p>
<h1 id="donkeycar-ai-framework">DonkeyCar AI Framework</h1>
<h2 id="setting-up-the-donkeycar-ai-framework">Setting up the DonkeyCar AI Framework</h2>
<p>Reference
<a href="http://docs.donkeycar.com">[http://docs.donkeycar.com]{.underline}</a></p>
<p>Make sure that the OpenCV you want to use supporting CUDA is already
available as a system</p>
<p>wide package.</p>
<p>Remember that when you are compiling and building software from source,
it may take a few hours ...</p>
<p>SSH into the Single Board Computer (SBC) e.g., RPI, JTN, JNX, etc.</p>
<p>\ Install some packaged, some may be already installed</p>
<pre><code>sudo apt update -y
</code></pre>
<pre><code>sudo apt upgrade -y
</code></pre>
<pre><code>sudo usermod -aG dialout jetson
</code></pre>
<p>#If packages are being held back</p>
<pre><code> sudo apt-get \--with-new-pkgs upgrade
</code></pre>
<pre><code>sudo apt-get install -y build-essential python3 python3-dev python3-pip
libhdf5-serial-dev hdf5-tools libhdf5-dev zlib1g-dev zip libjpeg8-dev
liblapack-dev libblas-dev gfortran libxslt1-dev libxml2-dev libffi-dev
libcurl4-openssl-dev libssl-dev libpng-dev libopenblas-dev openmpi-doc
openmpi-bin libopenmpi-dev libopenblas-dev git nano
</code></pre>
<p>Install RPi.GPIO clone for Jetson Nano</p>
<p><a href="https://github.com/NVIDIA/jetson-gpio">https://github.com/NVIDIA/jetson-gpio</a></p>
<pre><code>pip3 install Jetson.GPIO
</code></pre>
<blockquote>
<p>If the pip install complains about ownership of the directory*</p>
<p>then execute the following command</p>
<p>sudo chown -R jetson:jetson /home/jetson/.cache/pip</p>
<p>ex:</p>
<p>WARNING: The directory \'/home/jetson/.cache/pip/http\' or its parent
directory is not owned by the current user and the cache has been
disabled. Please check the permissions and owner of that directory. If
executing pip with sudo, you may want sudo\'s -H flag.</p>
<p>WARNING: The directory \'/home/jetson/.cache/pip\' or its parent
directory is not owned by the current user and caching wheels has been
disabled. check the permissions and owner of</p>
<p>that directory. If executing pip with sudo, you may want sudo\'s -H
flag.</p>
<p>If pip breaks for some reason, you can reinstall it with the following
lines</p>
<p>python3 -m pip uninstall pip</p>
<p>sudo apt install python3-pip --reinstall</p>
<p>If the install request elevated privileges, execute the following
command</p>
<p>sudo pip3 install Jetson.GPIO</p>
<p>if pip has a new version</p>
<p>pip3 install --upgrade pip</p>
</blockquote>
<p>Let's make sure the user jetson can use gpio</p>
<p>sudo groupadd -f -r gpio</p>
<p>sudo usermod -a -G gpio jetson</p>
<blockquote>
<p>sudo cp /opt/nvidia/jetson-gpio/etc/99-gpio.rules /etc/udev/rules.d/</p>
<p>28Jan20 - did not work with JetPack3.4</p>
<p>15May21- did not work with JetPack4.5</p>
<p>19Oct21 - did not work with JetPack4.6</p>
<p>18Sep22 - did not work with JetPack4.6.2</p>
<p>Will get back to it later if the jetson user can not access GPIO</p>
</blockquote>
<p>sudo udevadm control --reload-rules &amp;&amp; sudo udevadm trigger</p>
<p>We want to have control over the versions of each software library to
minimize the framework from</p>
<p>breaking after system-wide upgrades. Therefore, lets create a virtual
environment for the</p>
<p>DonkeyCar.</p>
<h3 id="create-a-virtual-environment-for-the-donkeycar-ai-framework">Create a virtual environment for the DonkeyCar AI Framework.</h3>
<p>If you want the virtual environment to be under the user's home
directory, make sure to be on the</p>
<p>home directory for user jetson</p>
<p>If you have not done so, lets create a directory to store our projects
and one subdirectory</p>
<p>to store virtual environments</p>
<pre><code>cd \~
</code></pre>
<pre><code>mkdir projects
</code></pre>
<pre><code>cd projects
</code></pre>
<pre><code>mkdir envs
</code></pre>
<pre><code>cd envs
</code></pre>
<pre><code>pip3 install virtualenv
</code></pre>
<blockquote>
<p>if complains about user permission</p>
<p>pip3 install virtualenv --user</p>
</blockquote>
<p>We will create a virtual environment called donkey since our AI
framework is</p>
<p>based on the Donkey Car project</p>
<p>Since your SBC will be initially dedicated to the class AI framework
(Donkey), at least until</p>
<p>your custom project starts, let's activate the donkey virtual env
automatically every time the user</p>
<p>Jetson logs into the SBC. We can remove this settings later if needed
when using ROS2</p>
<pre><code>echo \&quot;source \~/projects/envs/donkey/bin/activate\&quot; \&gt;\&gt; \~/.bashrc
</code></pre>
<pre><code>source \~/.bashrc
</code></pre>
<p>When a virtual environment is active, you should see
(name_of_virtual_enviroment) in front of the terminal prompt.</p>
<p>ex:</p>
<pre><code>(donkey)jetson@ucsdrobocar-xxx-yy:\~\$
</code></pre>
<p>At this point, using pip and pip3 should be the same as using pip3 by
default in this virtual environment.</p>
<p>https://docs.donkeycar.com/guide/robot_sbc/setup_jetson_nano/ 46</p>
<blockquote>
<h1 id="it-is-necessary-to-create-a-link-to-it">it is necessary to create a link to it</h1>
<p># Go to the folder where OpenCV\'s native library is built</p>
<h1 id="cd-usrlocallibpython36site-packagescv2python-36">cd /usr/local/lib/python3.6/site-packages/cv2/python-3.6</h1>
<p># Rename</p>
<h1 id="mv-cv2cpython-36m-xxx-linux-gnuso-cv2so">mv cv2.cpython-36m-xxx-linux-gnu.so cv2.so</h1>
<p># Go to your virtual environments site-packages folder if previously
set</p>
<h1 id="cd-envlibpython36site-packages">cd \~/env/lib/python3.6/site-packages/</h1>
<p># Or just go to your home folder if not set a venv site-packages
folder</p>
<h1 id="cd">cd \~</h1>
<p># Symlink the native library</p>
<h1 id="ln-s-usrlocallibpython36site-packagescv2python-36cv2so">ln -s /usr/local/lib/python3.6/site-packages/cv2/python-3.6/cv2.so</h1>
<p>cv2.so</p>
<h1 id="note-that-it-is-almost-mandatory-to-create-a-virtual-environment-in">NOTE that it is almost mandatory to create a virtual environment in</h1>
<p>order to properly install</p>
<p># tensorflow, scipy and keras, and always a best practice.</p>
</blockquote>
<pre><code>cd \~/projects/envs/donkey/lib/python3.6/site-packages/
</code></pre>
<pre><code>ln -s /usr/local/lib/python3.6/site-packages/cv2/python-3.6/cv2.so
</code></pre>
<pre><code>cv2.so
</code></pre>
<h3 id="_3"></h3>
<h3 id="confirm-that-opencv-built-from-previous-steps-is-working-on-the-virtual-environment-donkey">Confirm that OpenCV built from previous steps is working on the virtual environment Donkey</h3>
<p># Testing to see if OpenCV is installed in the virtual env.</p>
<pre><code>python3 -c \'import cv2 as cv; print(cv.\_\_version\_\_)\'
</code></pre>
<blockquote>
<p>(donkey) <strong>jetson@ucsdrobocar-xxx-yy</strong>:<strong>\~/projects/envs/donkey</strong>\$
python3 -c \'import cv2 as cv; print(cv.__version__)\'</p>
<p>4.6.0</p>
</blockquote>
<p># We won\'t use Python2, but just in case one will need it for some
reason</p>
<pre><code>python2 -c \'import cv2 as cv; print(cv.\_\_version\_\_)\'
</code></pre>
<p>We are not done installing software yet. We need to install more
dependencies..</p>
<p><strong>Make sure you have the donkey virtual environment activated</strong></p>
<p>Remember some of these installs may take a while. It does not mean that
the SBC is frozen, you</p>
<p>can see that the CPU is busy with top, htop, or jtop</p>
<pre><code>source \~/projects/envs/donkey/bin/activate
</code></pre>
<pre><code>pip3 install -U pip testresources setuptools
</code></pre>
<pre><code>pip3 install -U futures==3.1.1 protobuf==3.12.2 pybind11==2.5.0
</code></pre>
<pre><code>pip3 install -U cython==0.29.21 pyserial
</code></pre>
<pre><code>pip3 install -U future==0.18.2 mock==4.0.2 h5py==2.10.0
keras_preprocessing==1.1.2 keras_applications==1.0.8 gast==0.3.3
</code></pre>
<pre><code>pip3 install -U absl-py==0.9.0 py-cpuinfo==7.0.0 psutil==5.7.2
portpicker==1.3.1 six requests==2.24.0 astor==0.8.1 termcolor==1.1.0
wrapt==1.12.1 google-pasta==0.2.0
</code></pre>
<pre><code>pip3 install -U gdown
</code></pre>
<h3 id="tensorflow">Tensorflow</h3>
<p>Now let\'s install
<a href="https://www.tensorflow.org/">Tensorflow</a> (Artificial
Neural Network software).</p>
<blockquote>
<p>"TensorFlow is an end-to-end open source platform for machine
learning. It has a comprehensive, flexible ecosystem of tools,
libraries and community resources that lets researchers push the
state-of-the-art in ML and developers easily build and deploy ML
powered applications."</p>
</blockquote>
<p>Lets install Tensorflow enabled for GPU acceleration</p>
<p>Another chance for you to study while software is being installed...</p>
<p>Background information here</p>
<p><a href="https://docs.nvidia.com/deeplearning/frameworks/install-tf-jetson-platform/index.html">https://docs.nvidia.com/deeplearning/frameworks/install-tf-jetson-platform/index.html</a></p>
<p>Remember you are using a low power SBC, depending on the size of the
software it takes a while</p>
<p>We are installing Tensorflow outside the virtual environment so it is
available for other uses</p>
<p>Here is another chance for you to study while software is being
installed...</p>
<p><a href="https://docs.nvidia.com/deeplearning/frameworks/install-tf-jetson-platform/index.html">Background information
here</a></p>
<p>We are using JetPack 4.5 because the new DonkeyCar release was breaking
the install with JetPack4.6.2. It requires Python 7 and newer.</p>
<p>Let\'s stick with JetPack4.5 for now</p>
<p><a href="https://developer.download.nvidia.com/compute/redist/jp/v45/tensorflow/">https://developer.download.nvidia.com/compute/redist/jp/v45/tensorflow/</a></p>
<p>As of 18Sep22</p>
<blockquote>
<p>tensorflow-1.15.4+nv20.12-cp36-cp36m-linux_aarch64.whl 218MB
2020-12-18 14:54:04</p>
<p>tensorflow-2.3.1+nv20.12-cp36-cp36m-linux_aarch64.whl 264MB 2020-12-18
14:54:06</p>
<p>tensorflow-1.15.5+nv21.2-cp36-cp36m-linux_aarch64.whl 218MB 2021-02-26
16:10:00</p>
<p>tensorflow-2.4.0+nv21.2-cp36-cp36m-linux_aarch64.whl 273MB 2021-02-26
16:10:14</p>
<p>tensorflow-1.15.5+nv21.3-cp36-cp36m-linux_aarch64.whl 218MB 2021-03-25
18:14:17</p>
<p>tensorflow-2.4.0+nv21.3-cp36-cp36m-linux_aarch64.whl 273MB 2021-03-25
18:14:48</p>
<p>tensorflow-1.15.5+nv21.4-cp36-cp36m-linux_aarch64.whl 218MB 2021-04-26
20:36:59</p>
<p>tensorflow-2.4.0+nv21.4-cp36-cp36m-linux_aarch64.whl 273MB 2021-04-26
20:38:13</p>
<p>tensorflow-1.15.5+nv21.5-cp36-cp36m-linux_aarch64.whl 218MB 2021-05-20
20:19:08</p>
<p>tensorflow-2.4.0+nv21.5-cp36-cp36m-linux_aarch64.whl 274MB 2021-05-20
20:19:20</p>
<p>tensorflow-1.15.5+nv21.6-cp36-cp36m-linux_aarch64.whl 220MB 2021-06-29
18:18:14</p>
<p><strong>tensorflow-2.5.0</strong>+nv21.6-cp36-cp36m-linux_aarch64.whl 293MB
2021-06-29 18:18:43</p>
</blockquote>
<p># This will install the latest tensorflow compatible with the Jet Pack
as a system package</p>
<p>Alternatively if you want to chose a particular version:</p>
<pre><code>pip3 install \--pre \--extra-index-url
https://developer.download.nvidia.com/compute/redist/jp/v45
tensorflow==**2.3.1**
</code></pre>
<p>Remember you are using a low power SBC, depending on the size of the
software it takes a while</p>
<p>Lets verify that Tensorflow installed correctly</p>
<pre><code>python3
</code></pre>
<pre><code>import tensorflow
</code></pre>
<pre><code>exit()
</code></pre>
<blockquote>
<p>No errors should be reported</p>
<p><strong>If you get errors importing Tensorflow 2.5.0, try these</strong></p>
<p><strong>pip install numpy==1.19.2</strong></p>
</blockquote>
<p>ex:</p>
<p>If you see info with <strong>libcuda</strong> it means, Tensorflow will be
accelerated using the CUDA</p>
<p>cores of the SBC's GPU</p>
<p>(donkey) jetson@ucsdrobocar-xxx-yy:\~/projects\$ python3</p>
<p>Python 3.6.9 (default, Jun 29 2022, 11:45:57)</p>
<p>[GCC 8.4.0] on linux</p>
<p>Type \"help\", \"copyright\", \"credits\" or \"license\" for more
information.</p>
<p>&gt;&gt;&gt; import tensorflow</p>
<p>2022-08-09 12:19:25.285765: I
tensorflow/stream_executor/platform/default/dso_loader.cc:53]
Successfully opened dynamic library [libcudart.]{.mark}so.10.2</p>
<p>&gt;&gt;&gt; exit()</p>
<p>Verifying that TensorRT was installed</p>
<p>sudo apt-get update</p>
<p>(donkey) jetson@ucsdrobocar-xxx-yy:\~\$ sudo apt-get install tensorrt</p>
<p>Reading package lists... Done</p>
<p>Building dependency tree</p>
<p>Reading state information... Done</p>
<p>tensorrt is already the newest version (7.1.3.0-1+cuda10.2).</p>
<p>0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</p>
<p>dpkg -l | grep TensorRT</p>
<blockquote>
<p>arm64 Meta package of TensorRT</p>
<p>ii uff-converter-tf 7.1.3-1+cuda10.2 arm64 UFF converter for TensorRT
package</p>
</blockquote>
<p># Periodically the versions of tensorflow, cuDNN / CUDA give us
conflict. Here is a list of compatibility</p>
<p><a href="https://www.tensorflow.org/install/source#gpu">[https://www.tensorflow.org/install/sourcegpu]{.underline}</a></p>
<p>Installing pycuda - it will take a while again...</p>
<pre><code>pip3 install pycuda
</code></pre>
<p>If you are having errors installing pycuda use the following command:</p>
<pre><code>pip3 install pycuda==2020.1
</code></pre>
<h3 id="pytorch">PyTorch</h3>
<p>Lets install <a href="https://pytorch.org/">[PyTorch]{.underline}</a> too</p>
<p>"An open source machine learning framework that accelerates the path
from research prototyping to production deployment"</p>
<p>Again, these steps will take some time. Use your time wisely</p>
<pre><code>cd \~/projects
</code></pre>
<pre><code>wget
https://nvidia.box.com/shared/static/p57jwntv436lfrd78inwl7iml6p13fzh.whl
</code></pre>
<p>cp p57jwntv436lfrd78inwl7iml6p13fzh.whl
torch-1.8.0-cp36-cp36m-linux_aarch64.whl</p>
<pre><code>pip3 install torch-1.8.0-cp36-cp36m-linux_aarch64.whl
</code></pre>
<pre><code>sudo apt-get install libjpeg-dev zlib1g-dev libpython3-dev
libavcodec-dev libavformat-dev libswscale-dev
</code></pre>
<pre><code>git clone -b v0.9.0 https://github.com/pytorch/vision torchvision
</code></pre>
<pre><code>cd torchvision
</code></pre>
<pre><code>python setup.py install
</code></pre>
<pre><code>cd ../
</code></pre>
<p># it will take a good while again. Keep studying other things...</p>
<p>Testing Pythorch install</p>
<p>python</p>
<blockquote>
<p>import torch</p>
<p>print(torch.__version__)</p>
</blockquote>
<p>exit()</p>
<p>ex:</p>
<blockquote>
<p>(donkey) jetson@ucsdrobocar-xxx-yy:\~/projects\$ python</p>
<p>Python 3.6.9 (default, Jan 26 2021, 15:33:00)</p>
<p>[GCC 8.4.0] on linux</p>
<p>Type \"help\", \"copyright\", \"credits\" or \"license\" for more
information.</p>
<p>&gt;&gt;&gt; import torch</p>
<p>&gt;&gt;&gt; print(torch.__version__)</p>
<p>1.8.0</p>
<p>&gt;&gt;&gt; exit()</p>
<p>(donkey) jetson@ucsdrobocar-xxx-yy:\~/projects\$</p>
</blockquote>
<p>One more test</p>
<p>pip3 show torch</p>
<p>ex:</p>
<blockquote>
<p>Name: torch</p>
<p>Version: 1.8.0</p>
<p>Summary: Tensors and Dynamic neural networks in Python with strong GPU
acceleration</p>
<p>Home-page: https://pytorch.org/</p>
<p>Author: PyTorch Team</p>
<p>Author-email: packages@pytorch.org</p>
<p>License: BSD-3</p>
<p>Location:
/home/jetson/projects/envs/donkey/lib/python3.6/site-packages</p>
<p>Requires: dataclasses, typing-extensions, numpy</p>
<p>Required-by: torchvision</p>
</blockquote>
<h3 id="_4"></h3>
<h2 id="as-of-summer-ii-2022-we-are-using-a-new-stereo-camera-from-luxonis">As of Summer II 2022, we are using a new Stereo Camera from Luxonis</h2>
<h2 id="configuring-oakd-lite">Configuring OAKD Lite</h2>
<p>Open a terminal window and run the following commands:</p>
<p>sudo apt update &amp;&amp; sudo apt upgrade</p>
<p># after upgrades</p>
<p>sudo reboot now</p>
<p>If you have not added the extra swap space while building OpenCV, please
add it</p>
<p>You can use jtop to add more swap space using the left and right keys
and clicking the plus button</p>
<p>jtop</p>
<p>4</p>
<p><img alt="" src="../10images/media/image33.png" />{width="4.005208880139983in"
height="1.776890857392826in"}</p>
<p>Add 4G of swap and press \&lt;S&gt; to enable it.</p>
<p><img alt="" src="../10images/media/image25.png" />{width="3.0156255468066493in"
height="2.161738845144357in"}</p>
<blockquote>
<p>Alternatively you can use the command line</p>
<p># Disable ZRAM:</p>
<p>sudo systemctl disable nvzramconfig</p>
<p># Create 4GB swap file</p>
<p>sudo fallocate -l 4G /mnt/4GB.swap</p>
<p>sudo chmod 600 /mnt/4GB.swap</p>
<p>sudo mkswap /mnt/4GB.swap</p>
<p>If you have an issue with the final command, you can try the
following:</p>
<p>sudo nano /etc/fstab</p>
<p># Add this line at the bottom of the file</p>
<p>/mnt/4GB.swap swap swap defaults 0 0</p>
<p># Reboot</p>
<p>sudo reboot now</p>
</blockquote>
<h1 id="installing-dependencies">Installing dependencies</h1>
<p>Navigate to the directory where you will be installing the luxonis
libraries using cd \~/projects</p>
<pre><code>sudo nano install_dependencies.sh
</code></pre>
<p>Copy the entire contents of the file:
<a href="https://drive.google.com/file/d/1dA_MAeJbzDbkNlWzFMTlBraCIS2v965S/view?usp=share_link">install_dependencies.sh</a></p>
<pre><code>bash install_dependencies.sh
</code></pre>
<pre><code>echo \&quot;export OPENBLAS_CORETYPE=ARMV8\&quot; \&gt;\&gt; \~/.bashrc
</code></pre>
<pre><code>echo \'SUBSYSTEM==\&quot;usb\&quot;, ATTRS{idVendor}==\&quot;03e7\&quot;, MODE=\&quot;0666\&quot;\' \|
</code></pre>
<pre><code>sudo tee /etc/udev/rules.d/80-movidius.rules
</code></pre>
<pre><code>sudo udevadm control \--reload-rules &amp;&amp; sudo udevadm trigger
</code></pre>
<h1 id="navigate-using-cd-to-the-folder-where-you-would-like-to-install-the">Navigate using cd to the folder where you would like to install the</h1>
<p>camera example files and requirements</p>
<pre><code>cd \~/projects
</code></pre>
<pre><code>git clone
[https://github.com/luxonis/depthai-python.git](https://github.com/luxonis/depthai-python.git)
</code></pre>
<pre><code>cd depthai-python/examples
</code></pre>
<pre><code>python3 install_requirements.py
</code></pre>
<h1 id="if-you-want-to-test-the-camera-and-you-have-remote-desktop">If you want to test the camera and you have remote desktop</h1>
<p><a href="https://www.nomachine.com/download">NoMachine</a> already
installed and the OAKD Lite is connected to JTN , run the following in
the terminal on a NoMachine session</p>
<h1 id="navigate-to-the-examples-folder-in-depthai-python-first-and-then">Navigate to the examples folder in depthai-python first and then</h1>
<pre><code>cd ColorCamera
</code></pre>
<pre><code>python3 rgb_preview.py
</code></pre>
<p>You should be able to see preview video on the No machine desktop</p>
<h3 id="_5"></h3>
<h3 id="installing-donkeycar-ai-framework">Installing Donkeycar AI Framework</h3>
<p>Lets Install the Donkeycar AI Framework</p>
<p>If you are upgrading from Donkey3 then save the values from your
calibration that</p>
<p>you had on</p>
<p>myconfig.py</p>
<p>Then let\'s remove the old donkeycar and d3 directories</p>
<blockquote>
<p>cd \~/projects</p>
<p>rm -rf donkeycar</p>
<p>rm -rf d3</p>
<p>If the projects directory was not created yet, mkdir projects</p>
<h1 id="cd-projects">cd \~/projects</h1>
<p>Get donkeycar from Github</p>
<p>git clone https://github.com/autorope/donkeycar</p>
<p>cd donkeycar</p>
<p>cd \~/projects</p>
<p>git clone https://github.com/autorope/donkeycar</p>
<p>cd donkeycar</p>
<p>git fetch --all --tags -f</p>
<p>git checkout 4.5.1</p>
<p>pip install -e .[nano]</p>
</blockquote>
<p>Install more dependencies</p>
<p>sudo apt-get install python3-dev python3-numpy python-dev libsdl-dev
libsdl1.2-dev libsdl-image1.2-dev libsdl-mixer1.2-dev libsdl-ttf2.0-dev
libsdl1.2-dev libsmpeg-dev python-numpy subversion libportmidi-dev
ffmpeg libswscale-dev libavformat-dev libavcodec-dev libfreetype6-dev
libswscale-dev libjpeg-dev libfreetype6-dev</p>
<p>pip install pygame</p>
<p>Lets enable the use of synchronization of files with remote computers
using rsync</p>
<p>sudo apt-get install rsync</p>
<p>This part will take a bit of time. Be patient, please keep in mind that
you are using a low power</p>
<p>single board computer (SBC).</p>
<p>If you are curious if your SBC is really working, you can open another
tab in the terminal window</p>
<p>or a complete new terminal window, ssh to the JTN then execute the
command top or htop</p>
<p>look at the CPU utilization...</p>
<blockquote>
<p>Note I had problems installing Donkey with the latest version of pip
(20.0.2). I had to revert</p>
<p>to an earlier version of pip. See versions of pip here
[<a href="https://pip.pypa.io/en/stable/news/">https://pip.pypa.io/en/stable/news/</a></p>
<p>On 28 May20, it worked. Keeping the line below for reference in case
the problem happens again</p>
<p># pip install --upgrade pip==18.1</p>
</blockquote>
<p>Install Donkey with</p>
<pre><code>pip3 install -e .\[nano\]
</code></pre>
<p>Proceed to [Create a Car]](#create-a-car)</p>
<blockquote>
<p>cd \~/projects</p>
<p>git clone https://github.com/autorope/donkeycar</p>
<p>cd donkeycar</p>
<p>git fetch --all --tags -f</p>
<p>latestTag=\$(git describe --tags `git rev-list --tags
--max-count=1`)</p>
<p>git checkout \$latestTag</p>
<p>pip install -e .[[nano45]{.mark}]</p>
</blockquote>
<p>It may take a while. You may not see progress on the terminal. You can
ssh to the SBC</p>
<p>and run the command top or htop or jtop from another terminal/tab</p>
<p>Grab a coffee, go study something ...</p>
<h3 id="_6"></h3>
<h3 id="create-a-car">Create a Car</h3>
<p>Let's create a car on the path \~/project/d4</p>
<p>cd \~/projects/donkeycar</p>
<p>donkey createcar --path \~/projects/d4</p>
<p>If complains about old version of numpy and the install fails</p>
<p>pip install numpy --upgrade</p>
<p>using donkey v4.3.22 ...</p>
<p>Creating car folder: /home/jetson/projects/d4</p>
<p>making dir /home/jetson/projects/d4</p>
<p>The version of the Donkey car may be newer than the one above...</p>
<p># For Winter 2024</p>
<p>Make sure the DonkeyCar is version 4.5.1. The latest version of the
DonkeyCar (5.x) does not work at the Jetson Nano yet.</p>
<p>You spent several hours on this configuration right?! Please make a
backup of your uSD card - "<a href="https://docs.google.com/document/d/1TF1uGAFeDARNwbPkgg9xg4NvWPJvrsHW2I_IN9dWQH0/edit#heading=h.mwv009fkh5ax">Backup of the uSD
Card</a>"</p>
<h3 id="modifying-camera">Modifying Camera</h3>
<p>Change the camera type to MOCK to enable us to test the system without a
camera</p>
<p>nano myconfig.py</p>
<h1 id="camera">CAMERA</h1>
<p>CAMERA_TYPE = \"MOCK\" (PICAM|WEBCAM|CVCAM|CSIC|V4L|MOCK)</p>
<p># if you have USB camera connected to the JTN , use WEBCAM</p>
<p># And change this line so the Donkey can run using the web interface</p>
<p>USE_JOYSTICK_AS_DEFAULT = False</p>
<h3 id="_7"></h3>
<h3 id="quick-test">Quick Test</h3>
<p>Lets test the Donkey AI framework install</p>
<p>python manage.py drive</p>
<p>Lets connect to the JTN by using a web browser from your PC</p>
<p><a href="http://ucsdrobocar01.local:8887">[http://ucsdrobocar-xxx-yy:8887]{.underline}</a></p>
<p>You should see a screen like this</p>
<p><img alt="" src="../10images/media/image43.png" /></p>
<h1 id="we-stop-the-donkey-with-ctrl-c">We stop the Donkey with Ctrl-C</h1>
<p>Ctrl-C</p>
<h3 id="modifying-joystick">Modifying Joystick</h3>
<p>Now let\'s change the type of joystick we use with Donkey</p>
<p>nano myconfig.py</p>
<blockquote>
<p>JOYSTICK</p>
<p>[USE_JOYSTICK_AS_DEFAULT = True]{.mark} when starting the manage.py,
when True, wil\$</p>
<p>JOYSTICK_MAX_THROTTLE = 0.5 this scalar is multiplied with the -1 to\$</p>
<p>JOYSTICK_STEERING_SCALE = 1.0 some people want a steering that is
less\$</p>
<p>AUTO_RECORD_ON_THROTTLE = True if true, we will record whenever
throttle\$</p>
<p>[CONTROLLER_TYPE=\'F710\']{.mark} (ps3|ps4|xbox|nimbus|wiiu|F710)</p>
</blockquote>
<p>python manage.py drive</p>
<p>ex</p>
<blockquote>
<p>Starting vehicle...</p>
<p>Opening /dev/input/js0...</p>
<p>Device name: Logitech Gamepad F710</p>
<p>recorded 10 records</p>
<p>recorded 20 records</p>
<p>recorded 30 records</p>
<p>recorded 40 records</p>
<p>erased last 100 records.</p>
<p>E-Stop!!!</p>
<p>recorded 10 records</p>
<p>recorded 20 records</p>
<p>recorded 30 records</p>
<p>recorded 40 records</p>
<p>recorded 50 records</p>
</blockquote>
<p>The Right Joystick is the Throttle, the Left Joystick is the Steering</p>
<p>The Y Button deletes 5s of driving at the default configuration =100
records at 20 Hz</p>
<p>The A Button is the emergency break</p>
<p>Joystick Controls:</p>
<blockquote>
<p>+------------------+---------------------------+</p>
<p>| control | action |</p>
<p>+------------------+---------------------------+</p>
<p>| start | toggle_mode |</p>
<p>| B | toggle_manual_recording |</p>
<p>| Y | erase_last_N_records |</p>
<p>| A | emergency_stop |</p>
<p>| back | toggle_constant_throttle |</p>
<p>| R1 | chaos_monkey_on_right |</p>
<p>| L1 | chaos_monkey_on_left |</p>
<p>| circle | show_record_acount_status |</p>
<p>| R2 | enable_ai_launch |</p>
<p>| left_stick_horz | set_steering |</p>
<p>| right_stick_vert | set_throttle |</p>
<p>+------------------+---------------------------+</p>
</blockquote>
<p>If your joystick is not returning to neutral</p>
<p>You can add a deadzone value</p>
<p>on myconfig.py</p>
<p>ex:</p>
<blockquote>
<p>NETWORK_JS_SERVER_IP = \"192.168.0.1\"when listening for network
joystick cont\$</p>
<p>JOYSTICK_DEADZONE = 0.01 when non zero, this is the smallest throt\$</p>
<p>JOYSTICK_THROTTLE_DIR = -1.0 use -1.0 to flip forward/backward, use \$</p>
</blockquote>
<p>Lets Integrate the JTN and PWM Controller into the RC Chassis</p>
<p>Charge your LiPo Battery</p>
<p>After you charge your Lithium Polymer (LiPo) battery(ries) - <a href="https://rogershobbycenter.com/lipoguide/">[some info
here]{.underline}</a></p>
<p>Connect the battery(ries) <strong>and batteries monitor/alarm</strong></p>
<p>Please do not use the batteries without the batteries monitor/alarms</p>
<p><strong>If you discharge a LiPO batteries below a threshold lets say 3.0</strong></p>
<h1 id="_8"></h1>
<h2 id="vesc_1">VESC</h2>
<p>Ensure that you have already configured the VESC device using the VESC
Tool Software</p>
<p>Edit the myconfig.py to have these values</p>
<p>DRIVE_TRAIN_TYPE = \"VESC\"</p>
<p>VESC_MAX_SPEED_PERCENT =.2 ## Max speed as a percent of actual max
speed</p>
<p>VESC_SERIAL_PORT= \"/dev/ttyACM0\" ## check this val with ls /dev/tty*</p>
<p>VESC_HAS_SENSOR= True</p>
<p>VESC_START_HEARTBEAT= True</p>
<p>VESC_BAUDRATE= 115200</p>
<p>VESC_TIMEOUT= 0.05</p>
<p>VESC_STEERING_SCALE = .5</p>
<p>VESC_STEERING_OFFSET = .5</p>
<p>DONKEY_GYM = False</p>
<p>(we will leave the CAMERA_TYPE = "MOCK" for now to make sure we can
drive the car with the VESC)</p>
<p>Download the following files</p>
<p><a href="https://drive.google.com/drive/folders/19TS3VyNXQPBSr41yiPaxpI1lnxClI2c8?usp=sharing">https://drive.google.com/drive/folders/19TS3VyNXQPBSr41yiPaxpI1lnxClI2c8?usp=sharing</a></p>
<p>And replace them on the Jetson in the locations shown in the images
below. Note - to get the files on the jetson you can use SFTP (secure
file transfer protocol):</p>
<p>Examples on how to use SFTP:\</p>
<pre><code>sftp jetson@ucsdrobocar-148-xx.local
</code></pre>
<pre><code>cd To the directory you want to go to
</code></pre>
<pre><code>put /File/Path/On/Your/Computer
</code></pre>
<p>alternatively</p>
<pre><code>get filename /File/Location/You/Want/Them/Go/On/Your/Computer
</code></pre>
<p>To get a directory</p>
<pre><code>get -rf filename /File/Location/You/Want/Them/Go/On/Your/Computer
</code></pre>
<p>type "exit" to disconnect</p>
<h2 id="_9"><img alt="" src="../10images/media/image18.png" /><img alt="" src="../10images/media/image24.png" /></h2>
<p>Once these have been replaced, you should run</p>
<pre><code>python manage.py drive
</code></pre>
<p>It should first throw a pyvesc import error. Follow the description in
the terminal to install the needed libraries</p>
<p>Then run it again. It should throw a permissions error. Follow the
advice on how to fix the error with chmod</p>
<p>Int(10) error bug fix (Credit Saimai Lau and Albert Chang):\
When running python manage.py drive, the intermittent \"invalid literal
for int() with base 10: \'None\' error is from the VESC package checking
whether the version of the VESC is below 3.0, so we can comment out that
part since we\'re using 6.0 just do</p>
<pre><code>nano
/home/jetson/projects/envs/donkey/lib/python3.6/site-packages/pyvesc/VESC/VESC.py
</code></pre>
<p>and put # at the beginning of lines 38-40 Then \^S to save and \^X to
exit</p>
<p><img alt="" src="../10images/media/image35.png" /></p>
<p>Error explanation: The self.get_firmware_version() get thes version by
requesting it from the VESC and reading the replied bytes, but sometimes
the data is lost or incomplete so the function returns \'None\' as the
version. We already know the version is 6.0 so we don't need this
function.</p>
<h2 id="oakd">OAKD</h2>
<p>Once you have the VESC driving the car, you will need to make sure you
have set up the document by following the instructions labeled
Configuring OAKD Lite found <a href="#configuring-oakd-lite">earlier in this
document</a></p>
<p>Edit the myconfig.py camera type to OAKD</p>
<p>CAMERA_TYPE = \"OAKD\"</p>
<p>Make sure the camera is working by checking the images that are being
saved to the /data/images directory.</p>
<p>The easiest way to do this is to go to</p>
<p><a href="http://localhost:8887">http://localhost:8887</a> while
running donkeysim, and you should be able to see a livestream from the
camera. Note - if several people are running donkeysim at the same time
on the same wifi this interface may get buggy</p>
<p>You can also do this by either:
Transferring the files to you laptop or virtual machine</p>
<p>with scp, sftp, rsync, winscp (windows) or filezilla (mac)</p>
<p>or</p>
<p>Using NoMachine by following the instructions found
<a href="#remote-desktop-installation">here</a> in this document</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>